import{B as D}from"./bread_crumb-4a3FFmDt.js";import{b as V}from"./mitt-ERXh4EJ-.js";import{p as P,c as T,f as F,w as A,h as M}from"./product-TiCc-U-t.js";import{d as k,r,j as L,z as N,w as i,e as d,o as B,b as t,g as h,f as s,a as R,c as U,F as E,t as O,p as j,h as q,q as C,_ as z}from"./index-Rub71TYy.js";import"./index-eBEV3ODV.js";const H={class:"apply-notes"},Q=s("span",null,"申请备注：",-1),Y={class:"audit-notes"},G=s("span",null,"审核备注：",-1),J=k({__name:"notes",emits:["success"],setup(g,{expose:w,emit:v}){V.on("applyRow",a=>{f.value=a});const f=r(),u=r(),c=r(),_=r(!1),x=v,y=async a=>{const e=await P(f.value);e.audit_notes=c.value,e.audit_status=a,e.audit_person=localStorage.getItem("name"),e.apply_time=$(e.apply_time),(await T(e)).status==0&&(x("success"),_.value=!1)},$=a=>{let e=new Date(a),p=e.getFullYear(),m=("0"+(e.getMonth()+1)).slice(-2),l=("0"+e.getDate()).slice(-2),o=("0"+e.getHours()).slice(-2),S=("0"+e.getMinutes()).slice(-2),I=("0"+e.getSeconds()).slice(-2);return`${p}-${m}-${l} ${o}:${S}:${I}`},n=()=>localStorage.getItem("position")=="经理";return w({open:()=>{_.value=!0}}),(a,e)=>{const p=d("el-input"),m=d("el-button"),l=d("el-dialog");return B(),L(l,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=o=>_.value=o),title:"审核产品",width:"400px"},N({default:i(()=>[s("div",H,[Q,t(p,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value=o),rows:2,type:"textarea",disabled:""},null,8,["modelValue"])]),s("div",Y,[G,t(p,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),rows:2,type:"textarea",disabled:n()},null,8,["modelValue","disabled"])])]),_:2},[n()?void 0:{name:"footer",fn:i(()=>[t(m,{type:"success",onClick:e[2]||(e[2]=o=>y("通过"))},{default:i(()=>[h("通过审核")]),_:1}),t(m,{type:"danger",onClick:e[3]||(e[3]=o=>y("不通过"))},{default:i(()=>[h("拒绝审核")]),_:1})]),key:"0"}]),1032,["modelValue"])}}}),K=g=>(j("data-v-f578a3b0"),g=g(),q(),g),W={class:"common-wrapper"},X={class:"common-content"},Z=K(()=>s("div",{class:"table-header"},[s("div",{class:"left-header"},[s("span",{class:"tips"},"tips:双击表格进行审核")])],-1)),ee={class:"table-content"},te={class:"button-content"},ae={class:"table-footer"},oe=k({__name:"audit",setup(g){const w=r("审核列表"),v=r(),f=r([]),u=async(n=1)=>{f.value=await F(n)};u();const c=R({pageCount:1,currentPage:1}),_=()=>{},x=n=>{C.confirm(`您确定要撤回申请出库 ${n.product_name} 吗？`,"撤回出库申请",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await A(n.id)).status==0&&u(c.currentPage)})},y=n=>{C.confirm(`您确定要再次申请出库 ${n.product_name} 吗？`,"再次申请",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(async()=>{(await M(n.id)).status==0&&u(c.currentPage)})},$=n=>{V.emit("applyRow",n.id),v.value.open()};return(n,b)=>{const a=d("el-table-column"),e=d("el-button"),p=d("el-table"),m=d("el-pagination");return B(),U(E,null,[t(D,{name:w.value},null,8,["name"]),s("div",W,[s("div",X,[Z,s("div",ee,[t(p,{data:f.value,style:{width:"100%"},border:"",onRowDblclick:$},{default:i(()=>[t(a,{type:"index",width:"50"}),t(a,{prop:"product_id",label:"产品ID"}),t(a,{prop:"product_name",label:"产品名称"}),t(a,{prop:"product_out_number",label:"出库数量"}),t(a,{prop:"apply_person",label:"申请人"}),t(a,{prop:"audit_person",label:"审核人"}),t(a,{prop:"audit_time",label:"审核时间"},{default:i(({row:l})=>{var o;return[s("div",null,O((o=l.audit_time)==null?void 0:o.slice(0,10)),1)]}),_:1}),t(a,{label:"操作",width:"250",fixed:"right"},{default:i(({row:l})=>[s("div",te,[t(e,{type:"primary",onClick:o=>x(l),disabled:l.audit_status=="审核"},{default:i(()=>[h("撤回申请 ")]),_:2},1032,["onClick","disabled"]),t(e,{type:"success",onClick:o=>y(l),disabled:l.audit_status=="审核"},{default:i(()=>[h("再次申请 ")]),_:2},1032,["onClick","disabled"])])]),_:1})]),_:1},8,["data"])]),s("div",ae,[t(m,{"current-page":c.currentPage,"pager-count":7,"page-count":c.pageCount,onCurrentChange:_,layout:"prev, pager, next"},null,8,["current-page","page-count"])])])]),t(J,{ref_key:"note",ref:v,onSuccess:b[0]||(b[0]=l=>u(c.currentPage))},null,512)],64)}}}),ue=z(oe,[["__scopeId","data-v-f578a3b0"]]);export{ue as default};
