import{B as T}from"./bread_crumb-4a3FFmDt.js";import{a as A,O as j,e as W,s as z,g as G,b as N,d as H}from"./product-TiCc-U-t.js";import{d as S,r as b,a as k,e as n,o as F,j as R,w as l,f as i,b as e,g as q,E as J,_ as D,y as M,t as B,c as K,i as Q,F as X,s as Y,q as Z}from"./index-Rub71TYy.js";import{b as I}from"./mitt-ERXh4EJ-.js";import{o as O}from"./operation_log-jDFuVYa0.js";import"./index-eBEV3ODV.js";const ee={class:"dialog-content"},te={class:"dialog-footer"},le=S({__name:"add_product",emits:["success"],setup(L,{expose:x,emit:w}){const P=b("left"),t=k({product_name:"",product_category:"",product_unit:"",warehouse_number:null,product_single_price:null,product_create_person:localStorage.getItem("name")}),h=k({product_name:[{required:!0,message:"请输入产品名称",trigger:"blur"}],product_category:[{required:!0,message:"请选择产品类别",trigger:"blur"}],product_unit:[{required:!0,message:"请选择产品单位",trigger:"blur"}],warehouse_number:[{required:!0,message:"请输入产品入库数量",trigger:"blur"}],product_single_price:[{required:!0,message:"请输入产品入库单价",trigger:"blur"}],product_create_person:[{required:!0,message:"请输入入库操作人",trigger:"blur"}]}),$=w,V=async()=>{let U=!1;for(const o in t)if(t[o]==""){U=!0;break}U?J.error("请输入上传的产品信息"):(await A(t)).status==0&&($("success"),g.value=!1)},g=b(!1);return x({open:()=>{g.value=!0}}),(U,o)=>{const p=n("el-input"),u=n("el-form-item"),a=n("el-option"),y=n("el-select"),r=n("el-form"),d=n("el-button"),c=n("el-dialog");return F(),R(c,{modelValue:g.value,"onUpdate:modelValue":o[6]||(o[6]=s=>g.value=s),title:"产品入库",width:"600px","align-center":"",draggable:""},{footer:l(()=>[i("span",te,[e(d,{type:"primary",onClick:V},{default:l(()=>[q(" 确定 ")]),_:1})])]),default:l(()=>[i("div",ee,[e(r,{ref:"ruleFormRef",model:t,"label-position":P.value,rules:h,"label-width":"120px"},{default:l(()=>[e(u,{label:"产品名称",prop:"product_name"},{default:l(()=>[e(p,{modelValue:t.product_name,"onUpdate:modelValue":o[0]||(o[0]=s=>t.product_name=s)},null,8,["modelValue"])]),_:1}),e(u,{label:"产品类别",prop:"product_category"},{default:l(()=>[e(y,{modelValue:t.product_category,"onUpdate:modelValue":o[1]||(o[1]=s=>t.product_category=s),placeholder:"请选择产品类别"},{default:l(()=>[e(a,{label:"家电类",value:"家电类"}),e(a,{label:"服装类",value:"服装类"}),e(a,{label:"数码类",value:"数码类"}),e(a,{label:"食品类",value:"食品类"}),e(a,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"产品单位",prop:"product_unit"},{default:l(()=>[e(y,{modelValue:t.product_unit,"onUpdate:modelValue":o[2]||(o[2]=s=>t.product_unit=s),placeholder:"请选择产品单位"},{default:l(()=>[e(a,{label:"个",value:"个"}),e(a,{label:"件",value:"件"}),e(a,{label:"千克",value:"千克"}),e(a,{label:"盒",value:"盒"}),e(a,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"产品入库数量",prop:"warehouse_number"},{default:l(()=>[e(p,{modelValue:t.warehouse_number,"onUpdate:modelValue":o[3]||(o[3]=s=>t.warehouse_number=s)},null,8,["modelValue"])]),_:1}),e(u,{label:"产品入库单价",prop:"product_single_price"},{default:l(()=>[e(p,{modelValue:t.product_single_price,"onUpdate:modelValue":o[4]||(o[4]=s=>t.product_single_price=s)},null,8,["modelValue"])]),_:1}),e(u,{label:"入库操作人",prop:"product_create_person"},{default:l(()=>[e(p,{modelValue:t.product_create_person,"onUpdate:modelValue":o[5]||(o[5]=s=>t.product_create_person=s),disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position","rules"])])]),_:1},8,["modelValue"])}}}),oe=D(le,[["__scopeId","data-v-c17df3be"]]),ae={class:"product-name"},ue={class:"product-name"},re={class:"dialog-content"},ne={class:"dialog-footer"},de=S({__name:"apply_product",emits:["success"],setup(L,{expose:x,emit:w}){I.on("applyRow",o=>{t.id=o.id,t.warehouse_number=o.warehouse_number,t.product_name=o.product_name,t.product_single_price=o.product_single_price});const P=b("left"),t=k({id:null,product_name:"",warehouse_number:null,product_single_price:null,product_out_number:null,apply_person:localStorage.getItem("name"),apply_notes:""}),h=k({out_warehouse_number:[{required:!0,message:"请输入申请出库数量",trigger:"blur"}]}),$=()=>{if(t.warehouse_number&&t.product_out_number)return t.warehouse_number<t.product_out_number},V=w,g=async()=>{(await j(t)).status==0&&V("success"),_.value=!1},_=b(!1);return x({open:()=>{_.value=!0}}),M(()=>{I.all.clear()}),(o,p)=>{const u=n("el-input"),a=n("el-form-item"),y=n("el-form"),r=n("el-button"),d=n("el-dialog");return F(),R(d,{modelValue:_.value,"onUpdate:modelValue":p[4]||(p[4]=c=>_.value=c),title:"申请出库",width:"600px","align-center":"",draggable:""},{footer:l(()=>[i("span",ne,[e(r,{type:"primary",onClick:g,disabled:$()},{default:l(()=>[q(" 确定 ")]),_:1},8,["disabled"])])]),default:l(()=>[i("div",ae,"您申请出库的产品是:  "+B(t.product_name),1),i("div",ue,"该产品的库存还有:  "+B(t.warehouse_number),1),i("div",re,[e(y,{ref:"ruleFormRef",model:t,"label-position":P.value,rules:h,"label-width":"120px"},{default:l(()=>[e(a,{label:"出库数量",prop:"product_out_number"},{default:l(()=>[e(u,{modelValue:t.product_out_number,"onUpdate:modelValue":p[0]||(p[0]=c=>t.product_out_number=c)},null,8,["modelValue"])]),_:1}),e(a,{label:"出库申请人",prop:"apply_person"},{default:l(()=>[e(u,{modelValue:t.apply_person,"onUpdate:modelValue":p[1]||(p[1]=c=>t.apply_person=c),disabled:""},null,8,["modelValue"])]),_:1}),e(a,{label:"产品单价",prop:"product_single_price"},{default:l(()=>[e(u,{modelValue:t.product_single_price,"onUpdate:modelValue":p[2]||(p[2]=c=>t.product_single_price=c),disabled:""},null,8,["modelValue"])]),_:1}),e(a,{label:"申请出库备注",prop:"apply_notes"},{default:l(()=>[e(u,{modelValue:t.apply_notes,"onUpdate:modelValue":p[3]||(p[3]=c=>t.apply_notes=c),rows:2,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position","rules"])])]),_:1},8,["modelValue"])}}}),se=D(de,[["__scopeId","data-v-420c3e6e"]]),pe={class:"dialog-content"},ce={class:"dialog-footer"},ie=S({__name:"edit_product",emits:["success"],setup(L,{expose:x,emit:w}){I.on("editRow",u=>{t.id=u.id,t.product_id=u.product_id,t.product_name=u.product_name,t.product_category=u.product_category,t.product_unit=u.product_unit,t.warehouse_number=u.warehouse_number,g.value=u.warehouse_number,t.product_single_price=u.product_single_price});const P=b("left"),t=k({id:null,product_id:null,product_name:"",product_category:"",product_unit:"",warehouse_number:null,product_single_price:null}),h=k({product_name:[{required:!0,message:"请输入产品名称",trigger:"blur"}],product_category:[{required:!0,message:"请选择产品类别",trigger:"blur"}],product_unit:[{required:!0,message:"请选择产品单位",trigger:"blur"}],warehouse_number:[{required:!0,message:"请输入产品入库数量",trigger:"blur"}],product_single_price:[{required:!0,message:"请输入产品入库单价",trigger:"blur"}]}),$=w,V=b(),g=b(),_=u=>{if(g.value!==void 0)if(u>g.value){let a=u-g.value;V.value=`${t.product_name}的库存新增了${a}`}else{let a=g.value-u;V.value=`${t.product_name}的库存减少了${a}`}},U=async()=>{(await W(t)).status==0&&($("success"),V&&await O(localStorage.getItem("account"),localStorage.getItem("name"),V.value,"中级","成功")),o.value=!1},o=b(!1);return x({open:()=>{o.value=!0}}),M(()=>{I.all.clear()}),(u,a)=>{const y=n("el-input"),r=n("el-form-item"),d=n("el-option"),c=n("el-select"),s=n("el-form"),f=n("el-button"),E=n("el-dialog");return F(),R(E,{modelValue:o.value,"onUpdate:modelValue":a[6]||(a[6]=m=>o.value=m),title:"编辑产品",width:"600px","align-center":"",draggable:""},{footer:l(()=>[i("span",ce,[e(f,{type:"primary",onClick:U},{default:l(()=>[q(" 确定 ")]),_:1})])]),default:l(()=>[i("div",pe,[e(s,{ref:"ruleFormRef",model:t,"label-position":P.value,rules:h,"label-width":"120px"},{default:l(()=>[e(r,{label:"入库编号",prop:"product_id"},{default:l(()=>[e(y,{modelValue:t.product_id,"onUpdate:modelValue":a[0]||(a[0]=m=>t.product_id=m),disabled:""},null,8,["modelValue"])]),_:1}),e(r,{label:"产品名称",prop:"product_name"},{default:l(()=>[e(y,{modelValue:t.product_name,"onUpdate:modelValue":a[1]||(a[1]=m=>t.product_name=m)},null,8,["modelValue"])]),_:1}),e(r,{label:"产品类别",prop:"product_category"},{default:l(()=>[e(c,{modelValue:t.product_category,"onUpdate:modelValue":a[2]||(a[2]=m=>t.product_category=m),placeholder:"请选择产品类别"},{default:l(()=>[e(d,{label:"家电类",value:"家电类"}),e(d,{label:"服装类",value:"服装类"}),e(d,{label:"数码类",value:"数码类"}),e(d,{label:"食品类",value:"食品类"}),e(d,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"产品单位",prop:"product_unit"},{default:l(()=>[e(c,{modelValue:t.product_unit,"onUpdate:modelValue":a[3]||(a[3]=m=>t.product_unit=m),placeholder:"请选择产品单位"},{default:l(()=>[e(d,{label:"个",value:"个"}),e(d,{label:"件",value:"件"}),e(d,{label:"千克",value:"千克"}),e(d,{label:"盒",value:"盒"}),e(d,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"产品库存数量",prop:"warehouse_number"},{default:l(()=>[e(y,{modelValue:t.warehouse_number,"onUpdate:modelValue":a[4]||(a[4]=m=>t.warehouse_number=m),onInput:_},null,8,["modelValue"])]),_:1}),e(r,{label:"产品入库单价",prop:"product_single_price"},{default:l(()=>[e(y,{modelValue:t.product_single_price,"onUpdate:modelValue":a[5]||(a[5]=m=>t.product_single_price=m)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position","rules"])])]),_:1},8,["modelValue"])}}}),_e=D(ie,[["__scopeId","data-v-038e0fd4"]]),me={class:"common-wrapper"},ge={class:"common-content"},be={class:"table-header"},fe={class:"left-header"},ve={class:"right-header"},Ve={class:"table-content"},ye={class:"button-content"},we={class:"table-footer"},he=S({__name:"index",setup(L){const x=b("产品列表"),w=b(),P=async()=>{t.value=await z(w.value)},t=b([]),h=b(),$=()=>{h.value.open()},V=b(),g=r=>{I.emit("applyRow",r),V.value.open()},_=k({pageCount:1,currentPage:1});(async()=>{const r=await G();_.pageCount=Math.ceil(r.length/10)})();const o=async(r=1)=>{t.value=await N(r)};o();const p=async r=>{_.currentPage=r,t.value=await N(r)},u=b(),a=r=>{I.emit("editRow",r),u.value.open()},y=r=>{Z.confirm(`您确定要删除产品 ${r.product_name} 吗？`,"删除产品",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(async()=>{if((await H(r.id)).status==0){o(_.currentPage);let c=`删除了id为${r.product_id}
          的${r.product_name}`;await O(localStorage.getItem("account"),localStorage.getItem("name"),c,"高级","成功")}})};return(r,d)=>{const c=n("el-input"),s=n("el-button"),f=n("el-table-column"),E=n("el-table"),m=n("el-pagination");return F(),K(X,null,[e(T,{name:x.value},null,8,["name"]),i("div",me,[i("div",ge,[i("div",be,[i("div",fe,[e(c,{modelValue:w.value,"onUpdate:modelValue":d[0]||(d[0]=v=>w.value=v),class:"w-50 m-2 distance",placeholder:"输入账号进行搜索","suffix-icon":Q(Y),onChange:P},null,8,["modelValue","suffix-icon"])]),i("div",ve,[e(s,{type:"primary",onClick:$},{default:l(()=>[q("产品入库")]),_:1})])]),i("div",Ve,[e(E,{data:t.value,style:{width:"100%"},border:"",onCellDblclick:a},{default:l(()=>[e(f,{type:"index",width:"50"}),e(f,{prop:"product_id",label:"产品ID"}),e(f,{prop:"product_name",label:"产品名称",width:"100"}),e(f,{prop:"product_category",label:"产品类别",width:"120"}),e(f,{prop:"warehouse_number",label:"库存数量",width:"120"}),e(f,{prop:"product_single_price",label:"产品单价",width:"120"}),e(f,{prop:"product_create_person",label:"入库人"}),e(f,{prop:"product_create_time",label:"入库时间"},{default:l(({row:v})=>{var C;return[i("div",null,B((C=v.product_create_time)==null?void 0:C.slice(0,10)),1)]}),_:1}),e(f,{prop:"product_update_time",label:"最新编辑时间"},{default:l(({row:v})=>{var C;return[i("div",null,B((C=v.product_update_time)==null?void 0:C.slice(0,10)),1)]}),_:1}),e(f,{label:"操作",width:"250",fixed:"right"},{default:l(({row:v})=>[i("div",ye,[e(s,{type:"primary",onClick:C=>g(v),disabled:v.audit_status!=="在库"||v.warehouse_number==0},{default:l(()=>[q(" 申请出库 ")]),_:2},1032,["onClick","disabled"]),e(s,{type:"success",onClick:C=>y(v)},{default:l(()=>[q("删除产品 ")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),i("div",we,[e(m,{"current-page":_.currentPage,"pager-count":7,"page-count":_.pageCount,onCurrentChange:p,layout:"prev, pager, next"},null,8,["current-page","page-count"])])])]),e(oe,{ref_key:"addProduct",ref:h,onSuccess:o},null,512),e(se,{ref_key:"applyProduct",ref:V,onSuccess:d[1]||(d[1]=v=>o(_.currentPage))},null,512),e(_e,{ref_key:"editProduct",ref:u,onSuccess:d[2]||(d[2]=v=>o(_.currentPage))},null,512)],64)}}}),qe=D(he,[["__scopeId","data-v-fb4d46e1"]]);export{qe as default};
